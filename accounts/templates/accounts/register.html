{% load static %}
<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Wordistan | Register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'accounts/css/register.css' %}">
</head>

<body>
    <div class="container">
        <span style="display: flex; align-items: center; justify-content: center;">
            <img src="{% static 'images/wordistan_logo.png' %}" alt="Wordistan Logo" width="50px">
            <h1 style="margin: 5px 0px 0px 10px;">Wordistan</h1>
        </span>
        <p style="margin: 15px 0px 10px 0px;">Register, and Take the First Step <br>to Building Your Own Word Bank.</p>
        <form method="post" autocomplete="off">
            {% csrf_token %}
            <label for="first_name">First Name: <br>
                <input type="text" maxlength="50" name="first_name" id="first_name" required
                    autocapitalize="words"></label>
            <label for="last_name">Last Name: <br>
                <input type="text" name="last_name" id="last_name" maxlength="50" required
                    autocapitalize="words"></label>
            <label for="nick_name">Nick Name: <br>
                <input type="text" name="nick_name" id="nick_name" maxlength="30"></label>
            <label for="birthday">Birthday: <br>
                <input type="date" name="birthday" id="birthday" required></label>
            <label for="email">Email: <br>
                <input type="email" name="email" id="email" required></label>
            <label for="password1">Password: <br>
                <input type="password" name="password1" id="password1" required></label>
            <label for="password2">Password (again): <br>
                <input type="password" name="password2" id="password2" required></label>
            <button onclick="register(event)">Register</button>
        </form>
        <p>Do you have an account? <br><a href="{% url 'login' %}">Login</a></p>
    </div>
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');
        function register(event){
            event.preventDefault();
            const first_name = document.getElementById("first_name").value
            const last_name = document.getElementById("last_name").value
            const nick_name = document.getElementById("nick_name").value
            const birth_date = document.getElementById("birthday").value
            const email = document.getElementById("email").value
            const password = document.getElementById("password1").value
            const password_confirm = document.getElementById("password2").value
            fetch('api/register', {
                method:"POST",
                headers:{
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                credentials:'same-origin',
                body: JSON.stringify({
                    email: email,
                    first_name: first_name,
                    last_name: last_name,
                    nick_name: nick_name,
                    birth_date: birth_date,
                    password: password,
                    password_confirm: password_confirm })

            }).then((res)=>{
                if (res.status==201) {
                    alert("Welcome to Wordistan")
                    window.location.href = "/login"
                }
                else{
                    alert("Check your information!!!")
                }
            })
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>

</html>